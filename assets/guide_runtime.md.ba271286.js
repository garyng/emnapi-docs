import{_ as n,o as s,c as a,a as t}from"./app.0ba8a14d.js";const g='{"title":"emnapi Runtime","description":"","frontmatter":{},"headers":[],"relativePath":"guide/runtime.md","lastUpdated":1662189195000}',p={},e=t(`<h1 id="emnapi-runtime" tabindex="-1">emnapi Runtime <a class="header-anchor" href="#emnapi-runtime" aria-hidden="true">#</a></h1><p>Most APIs are implemented in JavaScript and they are depend on runtime code shipped in <code>library_napi.js</code> library file. So if you are building multiple wasm target, the same runtime code will be linked into each wasm glue js file. This is problematic when passing JavaScript objects across wasm bindings in same web page, we need to share emnapi&#39;s runtime code between multiple wasms like this:</p><ol><li><p>Installing emnapi runtime</p><div class="language-bash"><pre><code><span class="token function">npm</span> <span class="token function">install</span> @tybys/emnapi-runtime
</code></pre></div></li><li><p>Linking no runtime library build</p><ul><li><p>emcc</p><div class="language-bash"><pre><code>emcc <span class="token punctuation">..</span>. --js-library<span class="token operator">=</span>./node_modules/@tybys/emnapi/dist/library_napi_no_runtime.js
</code></pre></div></li><li><p>cmake</p><div class="language-cmake"><pre><code><span class="token keyword">add_subdirectory</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">\${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span></span>/node_modules/@tybys/emnapi&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>hello emnapi_noruntime<span class="token punctuation">)</span>
</code></pre></div></li></ul></li><li><p>Importing runtime code</p><ul><li><p>Browser</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>node_modules/@tybys/emnapi-runtime/dist/emnapi.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>your-wasm-glue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li><li><p>Node.js</p><p>Just npm install <code>@tybys/emnapi-runtime</code></p></li></ul><p>You can specify <code>emnapiRuntime</code> explicitly, this step is optional:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>node_modules/@tybys/emnapi-runtime/dist/emnapi.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> Module <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  Module<span class="token punctuation">.</span>emnapiRuntime <span class="token operator">=</span> window<span class="token punctuation">.</span>__emnapi_runtime__<span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>your-wasm-glue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// Node.js</span>
Module<span class="token punctuation">.</span>emnapiRuntime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@tybys/emnapi-runtime&#39;</span><span class="token punctuation">)</span>
</code></pre></div></li></ol><p><code>@tybys/emnapi-runtime</code> version should match <code>@tybys/emnapi</code> version.</p>`,4),o=[e];function c(i,l,u,r,k,d){return s(),a("div",null,o)}var _=n(p,[["render",c]]);export{g as __pageData,_ as default};
